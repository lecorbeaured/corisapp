<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>CORIS • Login</title>
  <link rel="icon" href="../favicon.ico">
  <link rel="apple-touch-icon" href="../assets/favicon.png"/>
  <link rel="stylesheet" href="../css/shared.css"/>
  <script src="../js/shared.js" defer></script>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "G-XXXXXXXXXX");
  </script>
</head>
<body>
<header class="topbar">
    <div class="container topbar-inner">
      <a class="brand" href="../index.html">
        <img src="../assets/coris-logo.svg" alt="CORIS"/>
        <div class="brand-title">
          <strong>CORIS</strong>
          <span>Bill companion</span>
        </div>
      </a>
      <div class="topbar-actions">
        <a class="btn" href="login.html">Login</a>
      </div>
    </div>
  </header>

  <main class="auth-layout">
    <div class="auth-card">
      <div class="card accent-top">
        <h1 class="h1">Welcome back</h1>
        <p class="sub">Sign in to your CORIS account.</p>

        <div id="authNotice"></div>

        <div class="field">
          <label class="label" for="email">Email</label>
          <input class="input" id="email" type="email" placeholder="you@example.com"/>
        </div>

        <div class="field">
          <label class="label" for="password">Password</label>
          <input class="input" id="password" type="password" placeholder="Your password"/>
        </div>

        <div class="row">
          <button class="btn primary" id="loginBtn" type="button" style="flex:1;">Sign in</button>
        </div>

        <div class="row mt-md" style="justify-content:center;">
          <a href="signup.html" class="small">Create an account</a>
          <span class="small" style="opacity:0.3;">·</span>
          <a href="forgot-password.html" class="small">Forgot password?</a>
        </div>
      </div>

      <div style="text-align:center;margin-top:16px;font-size:12px;">
        <a href="../legal/terms.html" class="text-muted">Terms</a>
        <span class="text-muted" style="opacity:0.3;margin:0 6px;">·</span>
        <a href="../legal/privacy.html" class="text-muted">Privacy</a>
        <span class="text-muted" style="opacity:0.3;margin:0 6px;">·</span>
        <a href="../legal/disclaimer.html" class="text-muted">Disclaimer</a>
      </div>
    </div>
  </main>


<script>
document.addEventListener("DOMContentLoaded", ()=>{
  const btn = document.getElementById("loginBtn");
  const notice = document.getElementById("authNotice");

  // Hide login link in nav for this page if already logged in
  const cfg = getCfg();
  if(cfg.csrf){
    notice.innerHTML = '<div class="notice ok"><strong>You are already logged in</strong><div class="small">Go to Dashboard.</div></div>';
  }

  btn.addEventListener("click", async ()=>{
    notice.innerHTML = "";
    try{
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      if(!email) throw new Error("Email is required.");
      if(!password) throw new Error("Password is required.");

      const res = await apiPublic(`/v1/auth/login`, { method:"POST", body: JSON.stringify({ email, password }) });
      localStorage.setItem("coris_csrf", res.csrf);
      location.href = "dashboard.html";
    }catch(err){
      showError(notice, err);
    }
  });
});
</script>

</body>
</html>
